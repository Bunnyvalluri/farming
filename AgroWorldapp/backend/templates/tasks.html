{% extends "base.html" %}

{% block content %}
<section class="section">
  <h2 class="section-title" data-key="task_title">Smart Task Manager</h2>

  <div style="max-width: 800px; margin: 0 auto;">
    <!-- Add Task Form -->
    <div class="feature-card" style="margin-bottom: 2rem;">
      <h3 data-key="task_add_title">Add New Task</h3>
      <div style="display: flex; gap: 1rem; margin-top: 1rem;">
        <input type="text" id="taskInput" placeholder="e.g., Water the wheat field"
          style="flex: 1; padding: 0.8rem 1.5rem; border-radius: 12px; border: 1px solid #ddd; outline: none;">
        <select id="taskCat" style="padding: 0.8rem; border-radius: 12px; border: 1px solid #ddd;">
          <option value="Irrigation">Irrigation</option>
          <option value="Fertilizer">Fertilizer</option>
          <option value="Pests">Pests</option>
          <option value="Harvest">Harvest</option>
        </select>
        <button class="lang-toggle" onclick="addTask()" data-key="task_add_btn">Add Task</button>
      </div>
    </div>

    <!-- Task List -->
    <div id="taskList">
      {% for task in tasks %}
      <div class="feature-card"
        style="margin-bottom: 1rem; padding: 1.5rem; display: flex; align-items: center; justify-content: space-between; {% if task.is_completed %}opacity: 0.6;{% endif %}">
        <div style="display: flex; align-items: center; gap: 1.5rem;">
          <div onclick="toggleTask({{ task.id }})"
            style="width: 30px; height: 30px; border-radius: 8px; border: 2px solid var(--primary); display: flex; align-items: center; justify-content: center; cursor: pointer; background: {% if task.is_completed %}var(--primary){% else %}transparent{% endif %};">
            {% if task.is_completed %}<i class="fa-solid fa-check" style="color: white;"></i>{% endif %}
          </div>
          <div>
            <h4 style="{% if task.is_completed %}text-decoration: line-through;{% endif %}">{{ task.title }}</h4>
            <small style="color: var(--text-muted);">{{ task.category }} â€¢ {{ task.created_at.strftime('%d %b, %H:%M')
              }}</small>
          </div>
        </div>
        <button onclick="deleteTask({{ task.id }})" id="del-{{ task.id }}"
          style="background: #fee2e2; border: none; color: #ef4444; width: 40px; height: 40px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
          <i class="fa-solid fa-trash-can"></i>
        </button>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  async function addTask() {
    const title = document.getElementById('taskInput').value;
    const category = document.getElementById('taskCat').value;
    if (!title) return;

    await fetch('/api/tasks', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ title, category })
    });
    location.reload();
  }

  async function toggleTask(id) {
    await fetch(`/api/tasks/${id}/toggle`, { method: 'POST' });
    location.reload();
  }

  async function deleteTask(id) {
    const res = await fetch(`/api/tasks/${id}`, { method: 'DELETE' });
    if (res.ok) location.reload();
  }
</script>
{% endblock %}