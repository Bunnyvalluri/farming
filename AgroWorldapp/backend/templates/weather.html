{% extends "base.html" %}

{% block content %}
<section class="py-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
  <!-- Header & Actions -->
  <div class="flex flex-col md:flex-row justify-between items-center gap-6 mb-12">
    <div>
      <h2 class="text-3xl md:text-4xl font-outfit font-extrabold text-slate-900 mb-2 flex items-center gap-4"
        data-key="weather_title">
        <i class="fa-solid fa-arrows-spin text-primary-600/20 animate-spin-slow"></i>
        Climate & Weather Forecast
      </h2>
      <p class="text-slate-500 font-medium" data-key="weather_desc">Real-time agricultural weather insights for your
        crops.</p>
    </div>

    <!-- Decorative Icons -->
    <div class="hidden lg:block absolute top-40 right-20 opacity-10 animate-spin-slow -z-10">
      <i class="fa-solid fa-sun text-[10rem] text-amber-200"></i>
    </div>
    <div class="hidden lg:block absolute bottom-20 left-20 opacity-10 animate-float -z-10">
      <i class="fa-solid fa-cloud text-[8rem] text-primary-200"></i>
    </div>

    <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
      <form action="/weather" method="GET" class="relative group grow">
        <input type="text" name="city" placeholder="Search City..." data-key="weather_search_ph" required
          class="w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-2xl focus:ring-4 focus:ring-primary-100 focus:border-primary-500 transition-all outline-none font-medium">
        <i
          class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary-600 transition-colors"></i>
        <button type="submit" class="hidden">Search</button>
      </form>

      <button onclick="getRealLocation()"
        class="flex items-center justify-center gap-3 px-6 py-3 bg-primary-600 text-white rounded-2xl font-bold hover:bg-primary-700 shadow-lg shadow-primary-600/20 transition-all hover:-translate-y-0.5 whitespace-nowrap">
        <i class="fa-solid fa-location-crosshairs"></i>
        <span data-key="weather_btn_loc">Use My Location</span>
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Current Weather Card -->
    <div class="lg:col-span-2 relative group">
      <div
        class="absolute inset-0 bg-gradient-to-br from-primary-600 to-primary-800 rounded-[2.5rem] shadow-2xl shadow-primary-600/20">
      </div>
      <div class="absolute top-0 right-0 p-12 opacity-20 animate-spin-slow">
        <i class="fa-solid fa-cloud-sun-rain text-9xl text-white"></i>
      </div>

      <div class="relative p-10 md:p-12 text-white flex flex-col h-full">
        <div class="flex justify-between items-start mb-12">
          <div>
            <h3 class="text-xl font-bold opacity-80 mb-1 flex items-center gap-2">
              <i class="fa-solid fa-location-dot"></i>
              {{ weather.current.location }}
            </h3>
            <p class="text-xs uppercase tracking-widest font-bold opacity-60">Today's Overview</p>
          </div>
          <div class="px-4 py-2 bg-white/10 backdrop-blur-md rounded-xl border border-white/20 text-sm font-bold"
            data-key="{{ weather.current.condition }}">
            {{ weather.current.condition }}
          </div>
        </div>

        <div class="mt-auto flex flex-col md:flex-row md:items-end justify-between gap-8">
          <div>
            <div class="text-7xl md:text-8xl font-outfit font-black leading-none mb-4 italic">{{ weather.current.temp
              }}°</div>
            <p class="text-lg opacity-80 max-w-xs leading-relaxed">Perfect conditions for spraying fertilizers today.
            </p>
          </div>

          <div
            class="grid grid-cols-3 gap-6 md:gap-12 bg-white/10 backdrop-blur-lg p-6 rounded-3xl border border-white/20">
            <div class="text-center">
              <p class="text-[10px] uppercase font-bold opacity-60 mb-2" data-key="weather_humidity">Humidity</p>
              <p class="text-xl font-bold">{{ weather.current.humidity }}%</p>
            </div>
            <div class="text-center border-x border-white/10 px-6 md:px-12">
              <p class="text-[10px] uppercase font-bold opacity-60 mb-2" data-key="weather_wind">Wind</p>
              <p class="text-xl font-bold">{{ weather.current.wind }}<span class="text-xs ml-1">km/h</span></p>
            </div>
            <div class="text-center">
              <p class="text-[10px] uppercase font-bold opacity-60 mb-2" data-key="weather_uv">UV Index</p>
              <p class="text-xl font-bold italic">Med</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Alerts & Tips -->
    <div class="space-y-6">
      <!-- Weather Alerts -->
      {% if weather.alerts %}
      <div class="bg-rose-50 border border-rose-100 rounded-[2rem] p-8 shadow-sm">
        <h3 class="flex items-center gap-3 text-rose-700 font-outfit font-extrabold text-xl mb-6">
          <i class="fa-solid fa-triangle-exclamation animate-pulse"></i>
          <span data-key="weather_alert_title">Weather Alerts</span>
        </h3>
        <div class="space-y-4">
          {% for alert in weather.alerts %}
          <div class="flex items-start gap-3 p-4 bg-white/60 rounded-2xl border border-rose-100">
            <div
              class="w-8 h-8 rounded-full bg-rose-100 text-rose-600 flex-shrink-0 flex items-center justify-center text-xs">
              <i class="fa-solid fa-bell"></i>
            </div>
            <p class="text-rose-900 font-semibold text-sm">{{ alert.text }}</p>
          </div>
          {% endfor %}
        </div>
      </div>
      {% else %}
      <div class="bg-primary-50 border border-primary-100 rounded-[2rem] p-8 shadow-sm">
        <h3 class="flex items-center gap-3 text-primary-700 font-outfit font-extrabold text-xl mb-4">
          <i class="fa-solid fa-shield-check"></i>
          <span>Weather Safety</span>
        </h3>
        <p class="text-primary-800/70 text-sm font-medium leading-relaxed">No extreme weather conditions detected for
          your current location. Safe to proceed with field activities.</p>
      </div>
      {% endif %}

      <!-- Smart Recommendation -->
      {% if weather.smart_tip %}
      <div class="bg-amber-50 border border-amber-100 rounded-[2rem] p-8 shadow-sm">
        <div
          class="w-12 h-12 bg-amber-500 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-amber-500/20 mb-6">
          <i class="fa-solid fa-lightbulb text-xl"></i>
        </div>
        <h4 class="text-amber-800 font-outfit font-extrabold text-xl mb-3" data-key="weather_smart_rec">Smart Tip</h4>
        <p class="text-amber-900/80 font-bold leading-relaxed italic">"{{ weather.smart_tip }}"</p>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- 5-Day Forecast -->
  <div class="mt-16">
    <div class="flex items-center justify-between mb-8">
      <h3 class="text-2xl font-outfit font-extrabold text-slate-900" data-key="weather_forecast">5-Day Forecast</h3>
      <div class="h-1 grow ml-8 bg-slate-100 rounded-full"></div>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">
      {% for day in weather.forecast %}
      <div
        class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm hover:shadow-xl hover:border-primary-100 transition-all group">
        <p class="text-sm font-bold text-slate-400 group-hover:text-primary-600 mb-6 transition-colors">{{ day.day }}
        </p>
        <div
          class="w-12 h-12 rounded-2xl bg-slate-50 flex items-center justify-center text-slate-600 mb-6 group-hover:bg-primary-50 group-hover:text-primary-600 transition-all duration-700 group-hover:rotate-[360deg]">
          <i
            class="fa-solid {% if day.cond == 'Sunny' %}fa-sun text-amber-500{% elif day.cond == 'Rainy' %}fa-cloud-showers-heavy text-blue-500{% else %}fa-cloud-sun text-primary-500{% endif %} text-2xl"></i>
        </div>
        <p class="text-3xl font-outfit font-black text-slate-900 mb-2 italic">{{ day.temp }}°</p>
        <p class="text-xs font-bold text-slate-500 uppercase tracking-wider" data-key="{{ day.cond }}">{{ day.cond }}
        </p>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

{% endblock %}

{% block scripts %}
<script>
  function getRealLocation() {
    showToast("Detecting your location...", "success");
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        window.location.href = `/weather?lat=${lat}&lon=${lon}`;
      }, function (error) {
        showToast("Location access denied or unavailable. Using default.", "error");
      });
    } else {
      showToast("Geolocation is not supported by this browser.", "error");
    }
  }
</script>
{% endblock %}