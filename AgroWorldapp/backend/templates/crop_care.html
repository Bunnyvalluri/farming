{% extends "base.html" %}

{% block content %}
<div class="relative min-h-screen bg-slate-50/30 py-20 md:py-32 px-4 sm:px-6 lg:px-8 font-outfit overflow-hidden">
  <!-- Dynamic Background Orbs -->
  <div
    class="absolute top-0 left-0 w-[500px] h-[500px] bg-primary-100/20 rounded-full blur-[120px] -z-10 animate-pulse">
  </div>
  <div
    class="absolute bottom-0 right-0 w-[600px] h-[600px] bg-emerald-100/20 rounded-full blur-[120px] -z-10 animate-pulse-slow">
  </div>

  <div class="max-w-7xl mx-auto relative z-10">
    <!-- Header Section -->
    <div class="text-center mb-24 max-w-4xl mx-auto">
      <div
        class="inline-flex items-center gap-3 px-5 py-2 bg-white/50 backdrop-blur-md border border-slate-200 rounded-2xl shadow-sm mb-8">
        <span class="relative flex h-2 w-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-primary-500"></span>
        </span>
        <span class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-500">Pathology Core Engine</span>
      </div>
      <h1 class="text-5xl md:text-7xl lg:text-8xl font-black text-slate-900 tracking-tighter leading-[0.9] mb-8"
        data-key="crop_page_title">
        Crop Health <br>
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-emerald-600">
          Intelligence
        </span>
      </h1>
      <p class="text-lg md:text-2xl text-slate-500 font-medium leading-relaxed opacity-80">
        Leveraging high-fidelity neural networks and institutional protocols to mitigate risk and optimize agrarian
        outputs.
      </p>
    </div>

    <!-- Crops Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 lg:gap-14">
      {% for crop in crops %}
      <div
        class="group relative bg-white rounded-[3.5rem] p-10 md:p-12 border border-slate-100 shadow-sm hover:shadow-[0_48px_120px_-16px_rgba(0,0,0,0.08)] transition-all duration-700 overflow-hidden flex flex-col">

        <div
          class="absolute inset-0 opacity-[0.03] group-hover:opacity-[0.05] transition-opacity duration-700 pointer-events-none"
          style="background-image: radial-gradient(#000 1px, transparent 1px); background-size: 24px 24px;">
        </div>

        <div class="relative z-10 flex flex-col h-full">
          <!-- Title & Icon -->
          <div class="flex items-center justify-between mb-12">
            <div
              class="w-16 h-16 bg-slate-50 text-emerald-600 rounded-2xl flex items-center justify-center text-3xl group-hover:scale-110 group-hover:bg-emerald-50 transition-all duration-700 shadow-inner">
              <i class="fa-solid {{ crop.icon }}"></i>
            </div>
            <div class="text-[9px] font-black text-slate-300 uppercase tracking-widest">Protocol-SECURE</div>
          </div>

          <h3 class="text-3xl font-black text-slate-900 tracking-tight mb-8" data-key="{{ crop.name_key }}"></h3>

          <!-- Common Diseases -->
          <div class="mb-10">
            <h4 class="text-[10px] uppercase font-black text-slate-400 tracking-[0.2em] mb-5"
              data-key="crop_common_dis">
              Pathogen Profile</h4>
            <div class="flex flex-wrap items-center gap-3">
              {% for d_key in crop.diseases_keys %}
              <div
                class="px-5 py-2 bg-rose-50 border border-rose-100/50 text-rose-600 rounded-xl text-[11px] font-black shadow-sm transition-all hover:bg-rose-100 block"
                data-key="{{ d_key }}"></div>
              {% endfor %}
            </div>
          </div>

          <!-- Care Tips -->
          <div class="mb-12 flex-grow">
            <h4 class="text-[10px] uppercase font-black text-slate-400 tracking-[0.2em] mb-4" data-key="crop_care_tips">
              Cultivation Matrix</h4>
            <p class="text-slate-600 text-base font-medium leading-relaxed opacity-90" data-key="{{ crop.care_key }}">
            </p>
          </div>

          <!-- View Detailed Skills Button -->
          <button onclick="viewDetailedSkills(this)"
            class="w-full py-5 rounded-2xl bg-slate-900 text-white font-black text-[12px] uppercase tracking-widest hover:bg-slate-800 transition-all shadow-xl active:scale-95 group/btn flex items-center justify-center gap-3"
            data-key="crop_btn_view">
            Access Skill Node
            <i class="fa-solid fa-arrow-right-long text-[10px] group-hover/btn:translate-x-2 transition-transform"></i>
          </button>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- AI Diagnostic Terminal -->
    <div class="mt-40 relative group">
      <div
        class="absolute inset-0 bg-slate-950 rounded-[5rem] shadow-[0_64px_160px_-32px_rgba(0,0,0,0.5)] overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-primary-600/10 via-transparent to-emerald-600/10"></div>
        <div class="absolute -top-40 -left-40 w-[30rem] h-[30rem] bg-primary-600/20 rounded-full blur-[160px]"></div>
      </div>

      <div class="relative grid grid-cols-1 lg:grid-cols-2 gap-16 p-12 md:p-24 items-center">
        <div class="space-y-10">
          <div
            class="inline-flex items-center gap-3 px-6 py-2.5 bg-primary-500/10 text-primary-400 rounded-full border border-primary-500/20">
            <i class="fa-solid fa-atom text-lg animate-spin-slow"></i>
            <span class="text-xs font-black uppercase tracking-[0.3em]">Neural Pathology Terminal</span>
          </div>
          <h2 class="text-4xl md:text-6xl font-black text-white tracking-tighter leading-tight"
            data-key="crop_ai_title">
            AI Symptom <br><span class="text-primary-500 italic">Extrapolation</span>
          </h2>
          <p class="text-slate-400 text-xl font-medium leading-relaxed opacity-80" data-key="crop_ai_desc">
            Analyze cellular deviations in real-time. Our vision transformer decrypts phenotypic signals to identify
            pathogens with near-absolute precision.
          </p>

          <div class="grid grid-cols-3 gap-8 pt-10 border-t border-slate-800/50">
            <div>
              <span class="block text-4xl font-black text-white tracking-tighter">99.2<span
                  class="text-primary-500">%</span></span>
              <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Model Fidelity</span>
            </div>
            <div>
              <span class="block text-4xl font-black text-white tracking-tighter">1.2<span
                  class="text-primary-500">s</span></span>
              <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Inference Wall</span>
            </div>
            <div>
              <span class="block text-4xl font-black text-white tracking-tighter">400<span
                  class="text-primary-500">k</span></span>
              <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Training Assets</span>
            </div>
          </div>
        </div>

        <!-- Terminal Interface -->
        <div
          class="bg-slate-900/50 backdrop-blur-3xl rounded-[3.5rem] border border-white/10 shadow-2xl overflow-hidden p-1">
          <div class="bg-black/40 p-5 border-b border-white/5 flex items-center justify-between">
            <div class="flex gap-2.5">
              <div class="w-3.5 h-3.5 rounded-full bg-rose-500/40"></div>
              <div class="w-3.5 h-3.5 rounded-full bg-amber-500/40"></div>
              <div class="w-3.5 h-3.5 rounded-full bg-emerald-500/40"></div>
            </div>
            <span class="text-[9px] font-black text-slate-500 uppercase tracking-[0.4em]">system_active:
              terminal://v2.0</span>
          </div>

          <div class="p-10 md:p-14">
            <div id="uploadZone"
              class="border-2 border-dashed border-white/10 rounded-[2.5rem] p-16 text-center group hover:border-primary-500/40 hover:bg-primary-500/5 transition-all cursor-pointer relative"
              onclick="document.getElementById('fileInput').click()">
              <input type="file" id="fileInput" class="hidden" accept="image/*" onchange="handleImageUpload(event)">

              <div id="uploadPlaceholder" class="space-y-8">
                <div
                  class="w-24 h-24 bg-white/5 text-primary-500 rounded-[2rem] flex items-center justify-center mx-auto shadow-2xl group-hover:scale-110 transition-all duration-700 border border-white/5">
                  <i class="fa-solid fa-fingerprint text-4xl"></i>
                </div>
                <div>
                  <h4 class="text-2xl font-black text-white mb-3" data-key="crop_ai_upload">Initialize Analysis</h4>
                  <p class="text-slate-500 text-[10px] font-black uppercase tracking-[0.3em]">Encrypted Data Stream
                    Required</p>
                </div>
              </div>

              <!-- Preview State -->
              <div id="previewContainer" class="hidden">
                <div class="relative inline-block group/preview">
                  <img id="previewImg"
                    class="max-h-72 rounded-3xl shadow-[0_0_80px_rgba(16,185,129,0.15)] border-2 border-white/10 transition-all duration-700">
                  <!-- Scanning Line Animation -->
                  <div
                    class="absolute inset-x-0 h-1.5 bg-primary-500 shadow-[0_0_30px_rgba(16,185,129,0.8)] z-20 animate-[scan_2.5s_infinite] opacity-80">
                  </div>
                  <!-- Grid Overlay -->
                  <div
                    class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20 rounded-3xl pointer-events-none">
                  </div>
                </div>
                <div class="mt-12 space-y-6">
                  <div class="flex items-center justify-center gap-5">
                    <div class="flex gap-1.5">
                      <div class="w-2 h-2 rounded-full bg-primary-500 animate-bounce"></div>
                      <div class="w-2 h-2 rounded-full bg-primary-500 animate-bounce [animation-delay:-0.15s]">
                      </div>
                      <div class="w-2 h-2 rounded-full bg-primary-500 animate-bounce [animation-delay:-0.3s]"></div>
                    </div>
                    <span id="diagnosticStatusText"
                      class="text-primary-500 font-black text-[10px] tracking-[0.3em] uppercase">Securing Neural
                      Link...</span>
                  </div>
                  <!-- Progress Bar System -->
                  <div
                    class="max-w-[280px] mx-auto h-1.5 bg-white/5 rounded-full overflow-hidden border border-white/10">
                    <div id="diagnosticProgressBar"
                      class="h-full bg-gradient-to-r from-primary-500 to-emerald-500 w-0 transition-all duration-500">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Analysis Output -->
            <div id="aiResults" class="hidden mt-12 space-y-8 animate-[fadeInUp_0.8s_ease-out]">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div class="bg-black/40 p-8 rounded-[2rem] border border-white/5">
                  <span class="text-[9px] font-black text-slate-500 uppercase tracking-[0.3em] block mb-4">Inference
                    Result</span>
                  <span id="mockDisease" class="text-rose-400 font-black text-2xl tracking-tight">---</span>
                </div>
                <div class="bg-black/40 p-8 rounded-[2rem] border border-white/5">
                  <span class="text-[9px] font-black text-slate-500 uppercase tracking-[0.3em] block mb-4">Confidence
                    Metric</span>
                  <span id="mockSeverity" class="text-amber-400 font-black text-2xl tracking-tight">---</span>
                </div>
              </div>

              <div class="bg-white/5 border border-white/10 p-10 rounded-[2.5rem] space-y-6">
                <h5 class="text-primary-400 font-black text-[10px] uppercase tracking-[0.3em] flex items-center gap-3">
                  <i class="fa-solid fa-microchip text-sm"></i>
                  Mitigation Script:
                </h5>
                <div id="mockTreatment" class="text-slate-300 text-base font-medium leading-[1.8]"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Premium Skill Modal -->
<div id="skillsModal"
  class="fixed inset-0 z-[100] hidden items-center justify-center p-6 bg-slate-950/90 backdrop-blur-2xl transition-all duration-500">
  <div class="absolute inset-0" onclick="closeDetailedSkills()"></div>
  <div
    class="relative bg-white w-full max-w-2xl rounded-[4rem] p-12 md:p-20 shadow-3xl overflow-y-auto max-h-[90vh] border border-slate-100 flex flex-col">
    <button onclick="closeDetailedSkills()"
      class="absolute top-12 right-12 w-14 h-14 flex items-center justify-center bg-slate-50 rounded-2xl hover:bg-rose-50 hover:text-rose-600 transition-all text-slate-400 group">
      <i class="fa-solid fa-xmark text-2xl group-hover:rotate-90 transition-transform"></i>
    </button>

    <div class="flex items-center gap-10 mb-16 pb-12 border-b border-slate-100">
      <div id="modalIcon"
        class="w-28 h-28 bg-primary-50 text-primary-600 rounded-[2.5rem] flex items-center justify-center text-5xl shadow-inner shadow-primary-900/5">
      </div>
      <div class="space-y-3">
        <h3 id="modalCropName" class="text-5xl font-black text-slate-900 tracking-tighter leading-none">Crop Node</h3>
        <p class="text-[10px] font-black text-primary-600 uppercase tracking-[0.4em]" data-key="adv_skill">Verified
          Protocol Engine</p>
      </div>
    </div>

    <div id="modalContentList" class="space-y-8 flex-grow">
      <!-- Injected -->
    </div>

    <div class="mt-16 p-8 bg-slate-50 rounded-[2.5rem] border border-slate-100 flex items-start gap-6">
      <div
        class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm shrink-0 border border-slate-100">
        <i class="fa-solid fa-circle-check text-2xl"></i>
      </div>
      <p class="text-slate-600 text-xs font-bold leading-relaxed opacity-80" data-key="diag_verified">
        This high-fidelity data is calibrated against institutional agricultural standards. For catastrophic infection
        events, immediate consultation with authorized agronomists is mandatory.
      </p>
    </div>
  </div>
</div>

<style>
  @keyframes scan {

    0%,
    100% {
      top: 0%;
    }

    50% {
      top: 100%;
    }
  }

  @keyframes slideUp {
    from {
      transform: translateY(40px);
      opacity: 0;
    }

    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .animate-pulse-slow {
    animation: pulse 6s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
</style>

<style>
  @keyframes scan {

    0%,
    100% {
      top: 0%;
    }

    50% {
      top: 100%;
    }
  }

  @keyframes slideUp {
    from {
      transform: translateY(40px);
      opacity: 0;
    }

    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .animate-pulse-slow {
    animation: pulse 6s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
</style>
{% endblock %}

{% block scripts %}
<script>
  const localTranslations = {
    'en': {
      'w1_t': 'Precision Irrigation', 'w1_d': 'Requires 4-6 irrigations at critical growth stages like CRI (21 days after sowing) for optimal kernel development.',
      'w2_t': 'Nutrient Optimization', 'w2_d': 'Apply Nitrogen in 3 splits (Basal, 1st, and 2nd irrigation). Phosphorus is mandatory at sowing.',
      'w3_t': 'Climatic Adaptation', 'w3_d': 'Complete sowing before 15th Nov. Late sowing reduces tillering duration and impacts final yield by 20%.',
      'r1_t': 'Hydro-Paddy Maintenance', 'r1_d': 'Maintain constant 5cm standing water during vegetative phase. Drain only before application or harvest.',
      'r2_t': 'Strain Specificity', 'r2_d': 'Use certified seeds. Seedlings must be exactly 21-25 days old to ensure strong root establishment.',
      'c1_t': 'Subsoil Engineering', 'c1_d': 'Deep summer ploughing is critical to eradicate pupae of bollworms and perennial deep-rooted weeds.',
      's1_t': 'Biological Treatment', 's1_d': 'Treat seeds with Rhizobium and PSB culture to boost nitrogen fixation capability naturally.',
      'co1_t': 'Vegetative Management', 'co1_d': 'Corn is a heavy feeder. Apply 120kg N in splits at 4-leaf, knee-high, and pre-tasseling stages.',
      'ca1_t': 'Structural Reinforcement', 'ca1_d': 'Perform earthing-up operation twice. This prevents lodging and enhances water-holding capacity near roots.',
      'su1_t': 'Solar Optimization', 'su1_d': 'Requires 6-8 hours of direct, unobstructed sunlight daily. Sowing must be oriented North-South.'
    },
    'hi': {
      'w1_t': 'सटीक सिंचाई', 'w1_d': 'इष्टतम कर्नेल विकास के लिए सीआरआई जैसे महत्वपूर्ण विकास चरणों में 4-6 सिंचाइयों की आवश्यकता होती है।',
      'w2_t': 'पोषक तत्व अनुकूलन', 'w2_d': 'नाइट्रोजन को 3 किस्तों में प्रयोग करें। बुवाई के समय फास्फोरस अनिवार्य है।',
      'w3_t': 'जलवायु अनुकूलन', 'w3_d': '15 नवंबर से पहले बुवाई पूरी करें। देर से बुवाई से उपज पर 20% का असर पड़ता है।',
      'r1_t': 'जल रखरखाव', 'r1_d': 'वानस्पतिक चरण के दौरान 5 सेमी पानी बनाए रखें। केवल आवेदन या कटाई से पहले निकालें।',
      'r2_t': 'तनाव विशिष्टता', 'r2_d': 'प्रमाणित बीजों का प्रयोग करें। मजबूत जड़ स्थापना सुनिश्चित करने के लिए पौधे 21-25 दिन पुराने होने चाहिए।',
      'c1_t': 'उपमृदा इंजीनियरिंग', 'c1_d': 'गुलाबी सुंडी और बारहमासी गहरी जड़ वाले खरपतवारों को खत्म करने के लिए गहरी जुताई महत्वपूर्ण है।',
      's1_t': 'जैविक उपचार', 's1_d': 'नाइट्रोजन स्थिरीकरण क्षमता को स्वाभाविक रूप से बढ़ाने के लिए राइजोबियम और पीएसबी कल्चर के साथ बीजों का उपचार करें।',
      'co1_t': 'वानस्पतिक प्रबंधन', 'co1_d': 'मक्का एक भारी फीडर है। 120 किलोग्राम नाइट्रोजन को विभिन्न चरणों में दें।',
      'ca1_t': 'संरचनात्मक सुदृढीकरण', 'ca1_d': 'मिट्टी चढ़ाने का काम दो बार करें। यह गिरने को रोकता है।',
      'su1_t': 'सौर अनुकूलन', 'su1_d': 'रोजाना 6-8 घंटे सीधी धूप की आवश्यकता होती है। बुवाई उत्तर-दक्षिण उन्मुख होनी चाहिए।'
    },
    'te': {
      'w1_t': 'ఖచ్చితమైన నీటిపారుదల', 'w1_d': 'గరిష్ట కెర్నెల్ అభివృద్ధి కోసం కీలక దశలలో 4-6 నీటిపారుదలలు అవసరం.',
      'w2_t': 'పోషక ఆప్టిమైజేషన్', 'w2_d': 'నైట్రోజన్‌ను 3 వాయిదాలలో వర్తించండి. విత్తే సమయంలో ఫాస్పరస్ తప్పనిసరి.',
      'w3_t': 'వాతావరణ అనుసరణ', 'w3_d': 'నవంబర్ 15 లోపు విత్తడం పూర్తి చేయండి. ఆలస్యంగా విత్తడం వల్ల దిగుబడి 20% తగ్గుతుంది.',
      'r1_t': 'హైడ్రో-ప్యాడీ నిర్వహణ', 'r1_d': 'మొక్కల దశలో స్థిరమైన 5cm నీటిని నిర్వహించండి. కోత లేదా మందుల ముందు మాత్రమే నీరు తీయండి.',
      'r2_t': 'స్ట్రెయిన్ ప్రత్యేకత', 'r2_d': 'ధృవీకృత విత్తనాలను ఉపయోగించండి. బలమైన వేరు స్థాపన కోసం మొక్కలు 21-25 రోజుల వయస్సు ఉండాలి.',
      'c1_t': 'సబ్‌సాయిల్ ఇంజనీరింగ్', 'c1_d': 'లోతైన వేసవి దున్నడం వల్ల కీటకాలు మరియు లోతైన కలుపు మొక్కలను నాశనం చేయవచ్చు.',
      's1_t': 'జీవ చికిత్స', 's1_d': 'నైట్రోజన్ వృద్ధిని సహజంగా పెంచడానికి రైజోబియం మరియు పీఎస్‌బీ తో విత్తనాలను శుద్ధి చేయండి.',
      'co1_t': 'మొక్కల నిర్వహణ', 'co1_d': 'మొక్కజొన్నకు ఎక్కువ పోషణ అవసరం. వివిధ దశలలో 120కిలోల నైట్రోజన్ వేయండి.',
      'ca1_t': 'నిర్మాణ బలోపేతం', 'ca1_d': 'మట్టి ఎగదోయడం రెండుసార్లు చేయండి. ఇది మొక్క పడిపోకుండా నివారిస్తుంది.',
      'su1_t': 'సౌర ఆప్టిమైజేషన్', 'su1_d': 'రోజూ 6-8 గంటల ప్రత్యక్ష సూర్యకాంతి అవసరం. ఉత్తర-దక్షిణ దిశగా విత్తాలి.'
    }
  };

  if (typeof translations !== 'undefined') {
    Object.keys(localTranslations).forEach(lang => {
      if (translations[lang]) Object.assign(translations[lang], localTranslations[lang]);
    });
  }

  const cropSkillsData = {
    'wheat_name': [
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-droplet text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="w1_t">Precision Irrigation</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="w1_d">Requires 4-6 irrigations at critical growth stages like CRI (21 days after sowing) for optimal kernel development.</p></div></div>',
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-flask text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="w2_t">Nutrient Optimization</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="w2_d">Apply Nitrogen in 3 splits (Basal, 1st, and 2nd irrigation). Phosphorus is mandatory at sowing.</p></div></div>',
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-wind text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="w3_t">Climatic Adaptation</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="w3_d">Complete sowing before 15th Nov. Late sowing reduces tillering duration and impacts final yield by 20%.</p></div></div>'
    ],
    'rice_name': [
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-water text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="r1_t">Hydro-Paddy Maintenance</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="r1_d">Maintain constant 5cm standing water during vegetative phase. Drain only before application or harvest.</p></div></div>',
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-dna text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="r2_t">Strain Specificity</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="r2_d">Use certified seeds. Seedlings must be exactly 21-25 days old to ensure strong root establishment.</p></div></div>'
    ],
    'cotton_name': [
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-mountain text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="c1_t">Subsoil Engineering</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="c1_d">Deep summer ploughing is critical to eradicate pupae of bollworms and perennial deep-rooted weeds.</p></div></div>'
    ],
    'soya_name': [
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-vial-circle-check text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="s1_t">Biological Treatment</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="s1_d">Treat seeds with Rhizobium and PSB culture to boost nitrogen fixation capability naturally.</p></div></div>'
    ],
    'corn_name': [
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-leaf text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="co1_t">Vegetative Management</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="co1_d">Corn is a heavy feeder. Apply 120kg N in splits at 4-leaf, knee-high, and pre-tasseling stages.</p></div></div>'
    ],
    'cane_name': [
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-cubes-stacked text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="ca1_t">Structural Reinforcement</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="ca1_d">Perform earthing-up operation twice. This prevents lodging and enhances water-holding capacity near roots.</p></div></div>'
    ],
    'sun_name': [
      '<div class="flex items-start gap-5 p-6 rounded-3xl bg-slate-50 border border-slate-100/50 group hover:border-primary-300 transition-all duration-300"><div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-primary-600 shadow-sm"><i class="fa-solid fa-sun-plant-wilt text-xl"></i></div><div><h5 class="text-slate-900 font-bold mb-1" data-key="su1_t">Solar Optimization</h5><p class="text-slate-500 text-sm leading-relaxed" data-key="su1_d">Requires 6-8 hours of direct, unobstructed sunlight daily. Sowing must be oriented North-South.</p></div></div>'
    ]
  };

  function viewDetailedSkills(btn) {
    const card = btn.closest('.group');
    const titleEl = card.querySelector('h3');
    const iconClass = card.querySelector('i').className;
    const cropKey = titleEl.getAttribute('data-key');
    const cropName = titleEl.innerText;

    showToast(`Accessing Skill Intelligence for ${cropName}...`, 'success');

    document.getElementById('modalCropName').innerText = cropName;
    document.getElementById('modalIcon').innerHTML = `<i class="${iconClass}"></i>`;

    const skills = cropSkillsData[cropKey] || cropSkillsData['wheat_name'];
    document.getElementById('modalContentList').innerHTML = skills.join('');

    const modal = document.getElementById('skillsModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    document.body.style.overflow = 'hidden';

    if (typeof applyTranslations === 'function') {
      applyTranslations();
    }
  }

  function closeDetailedSkills() {
    document.getElementById('skillsModal').classList.add('hidden');
    document.getElementById('skillsModal').classList.remove('flex');
    document.body.style.overflow = 'auto';
  }

  const mockScenarios = [
    { disease: "Bacterial Blight", severity: "MODERATE (42.5%)", treatment: "<p>• Initiate application of Copper Oxychloride (50% WP) at 3g/L.</p><p>• Enhance irrigation field drainage immediately.</p><p>• Suspend all nitrogen-based fertilizers for 144 hours.</p>" },
    { disease: "Powdery Mildew", severity: "HIGH (78.9%)", treatment: "<p>• Deploy Wettable Sulfur (80% WP) at concentration of 2.2g/L.</p><p>• Prune and biosecurely destroy all infected leaf biomass.</p><p>• Limit overhead irrigation to suppress humidity levels.</p>" },
    { disease: "Healthy Vegetation", severity: "STABLE (0.01%)", treatment: "<p>• Active monitoring protocol sufficient.</p><p>• Maintain current standardized hydration and nutrient cycle.</p><p>• Next scheduled AI scan: 72 hours.</p>" },
    { disease: "Rust Infection", severity: "CRITICAL (88.4%)", treatment: "<p>• Immediate deployment of Propiconazole (25% EC) at 1ml/L.</p><p>• Quarantine affected plot to prevent cross-contamination.</p><p>• Alert neighboring farming zones of spore presence.</p>" }
  ];

  function handleImageUpload(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        document.getElementById('uploadPlaceholder').classList.add('hidden');
        document.getElementById('previewContainer').classList.remove('hidden');
        document.getElementById('previewImg').src = e.target.result;
        document.getElementById('aiResults').classList.add('hidden');

        showToast("Accessing Neural Processing Unit...", "success");

        const diagStatus = document.getElementById('diagnosticStatusText');
        const diagProgress = document.getElementById('diagnosticProgressBar');

        // Stage 1: Texture Analysis
        setTimeout(() => {
          diagStatus.innerText = "Analyzing Leaf Textures...";
          diagProgress.style.width = "40%";
        }, 400);

        // Stage 2: Database Cross-ref
        setTimeout(() => {
          diagStatus.innerText = "Cross-referencing Pathogens...";
          diagProgress.style.width = "75%";
        }, 1000);

        // Final Inference
        setTimeout(() => {
          const mock = mockScenarios[Math.floor(Math.random() * mockScenarios.length)];
          diagProgress.style.width = "100%";

          document.getElementById('mockDisease').innerText = mock.disease;
          document.getElementById('mockSeverity').innerText = mock.confidence || mock.severity;
          document.getElementById('mockTreatment').innerHTML = mock.treatment;

          const colorClass = mock.disease === 'Healthy Vegetation' ? 'text-emerald-400' : 'text-rose-400';
          document.getElementById('mockDisease').className = `font-black text-lg ${colorClass}`;

          document.getElementById('aiResults').classList.remove('hidden');
          window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }, 1400);
      }
      reader.readAsDataURL(file);
    }
  }
</script>
{% endblock %}